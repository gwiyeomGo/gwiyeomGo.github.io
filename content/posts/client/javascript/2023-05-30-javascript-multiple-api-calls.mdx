---
title: JavaScript promise all 로 get API 여러개를 호출하고 각각의 응답값을 받자
date: 2023-05-30
slug: "/javascript/2023-05-30-javascript-multiple-api-calls"
tags:
  - JAVASCRIPT
  - REACT
  - 2023
---

다중으로 보내는 API 그룹
# 배경
어드민 회원 상세에서 이력 관련된 API 를 7개 부른다
코드를 짧게 줄이는 방법을 찾아보니 `Promise.all`을 사용한 코드가 있엇다


https://stackoverflow.com/questions/57204895/how-to-fire-multiple-api-calls-asynchronously-at-the-same-time
```
React.useEffect(()=>{
Promise.all([
    fetch('https://jsonplaceholder.typicode.com/posts'),
    fetch('https://jsonplaceholder.typicode.com/users')
]).then(function (responses) {
    // Get a JSON object from each of the responses
    return Promise.all(responses.map(function (response) {
        return response.json();
    }));
}).then(function (data) {
    // Log the data to the console
    // You would do something with both sets of data here
    console.log(data);
}).catch(function (error) {
    // if there's an error, log it
    console.log(error);
});
},[])
```

실제로는 아래 처럼 적용했다

```
import React, { useEffect, useState } from "react";
import axios from "axios";

const App = () => {
  const [data, setData] = useState({
    test1: [],
    test2: []
  });

  const fetchData = async () => {
    // root/public/test.json
    try {
      const [test1, test2] = await Promise.all([
        axios.get("/test1.json"),
        axios.get("/test2.json")
      ]);

      Object.keys(test1.data).length > 0 &&
        setData((pre) => ({
          ...pre,
          test1: test1.data
        }));

      Object.keys(test2.data).length > 0 &&
        setData((pre) => ({
          ...pre,
          test2: test2.data
        }));
    } catch (error) {
      console.log(error);
    }
  };
  useEffect(() => {
    fetchData();
  }, []);

  return (
    <>
      {Object.keys(data).length > 0 &&
        data.test1.length > 0 &&
        console.log(data.test1)}
    </>
  );
};
export default App;
```
[예제](https://codesandbox.io/s/datagetex-v621x2)


# 참고


https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all
https://www.andreadiotallevi.com/blog/how-to-handle-multiple-set-state-calls-on-the-same-object-in-react
https://joshua1988.github.io/web-development/javascript/js-async-await/
https://stackoverflow.com/questions/44182951/axios-chaining-multiple-api-requests
https://stackoverflow.com/questions/57204895/how-to-fire-multiple-api-calls-asynchronously-at-the-same-time