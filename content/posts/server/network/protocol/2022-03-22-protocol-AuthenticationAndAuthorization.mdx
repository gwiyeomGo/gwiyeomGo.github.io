---
title: LOGIN 로그인을 공부해보자 authorization and authentication
date: 2022-03-22
slug: "/protocol/2022-03-22-protocol-AuthenticationAndAuthorization"
tags:
  - LOGIN
  - PROTOCOL
---


# 1.AAA architecture protocols
```
AAA architecture protocols (Authentication, Authorization, Accounting)
Complex protocols used in larger networks for verifying the user (Authentication), controlling access to server data (Authorization) and monitoring network resources and information needed for billing of services (Accounting).
// 위키: https://en.wikipedia.org/wiki/Authentication_protocol
```

## [2.authentication (인증)](https://en.wikipedia.org/wiki/Authentication)
* 인증 : 사용자의 신원을 확인하는 행동
* ex) 회원가입,로그인
  ex) 대리 운전사가 내 자동차의 키를 받아서 잠시 일시적으로 자동차를 운전할 수 있는 권한이 있음
```
Authentication is 
 is the act of proving an assertion, such as the identity (신원)
  of a computer system user.
   (컴퓨터 시스템 사용자의 신원과 같은 주장을 증명하는 행위)
```

1. 유저가 로그인 시도
2. 서버상에 일치하는 유저 정보를 찾는다
3. 찾았다면 인증(authentication)확인의 표시로 세션/토큰을 빌급/전달 
4. 웹 브라우저 세션/토큰을 관리하고
5. 새롭게 서버로 요청을 보낼 때 인가(authorization)하기 위해 세션/토큰을 함께 보낸다.
[출처](https://fierycoding.tistory.com/69)
   

### authentication(인증) 의 타입
 * bearer
 * Basic
 ...
[(출처)bearer 는 무엇인가?](https://velog.io/@cada/%ED%86%A0%EA%B7%BC-%EA%B8%B0%EB%B0%98-%EC%9D%B8%EC%A6%9D%EC%97%90%EC%84%9C-bearer%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C)


###jwt (json web token)
```
JSON Web Token  is a proposed Internet standard for creating data with optional signature and/or optional encryption whose payload holds JSON that asserts some number of claims.
The tokens are signed either using a private secret or a public/private key.
//https://en.wikipedia.org/wiki/JSON_Web_Token
```

인증을 위한 토큰
토큰 사용자인증을 위한 정보를 서명한 것

https://opentutorials.org/course/3405

* 인코딩/디코딩?

jwt.io 사이트에서도 jwt 토큰을 디코딩한 결과를 알수 잇다.
이처럼 지금 사이트는 서베에서 디코딩해서 토큰안에 정보를 얻음

cookie의 사용을 제거
토큰 등의 정보를 cookie로 저장하면,
domain 기반으로 불필요한 cookie가 전달되어 예상치 못한 오류를 야기할 수 있다.
이런 경우 cookie 대신 HTML5 spec에 있는 Web Storage(Session/Local storage)를 사용하는 것이 더 일반적4

---

이때 원인은 jwt 토큰
* [참고](https://naon.me/posts/til63)

admin 화면(프론트)에서 토큰 생성시간은 로컬타임
service 는 gmt 글로벌 타임 (GMT)

service 시간을 로컬타임으로 변경
* [참고1](https://webisfree.com/2022-01-10/[%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8]-%EB%B0%A9%EB%AC%B8%EC%9E%90%EC%9D%98-%EB%A1%9C%EC%BB%AC-%ED%83%80%EC%9E%84%EC%A1%B4%EA%B3%BC-utc-%EC%8B%9C%EA%B0%84%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B5%AC%ED%95%A0%EA%B9%8C)
https://velog.io/@cada/%ED%86%A0%EA%B7%BC-%EA%B8%B0%EB%B0%98-%EC%9D%B8%EC%A6%9D%EC%97%90%EC%84%9C-bearer%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C






## [3.authorization (인가)](https://en.wikipedia.org/wiki/Authorization)
* 인가하다(대상이 옳음을 소상하게 밝혀 인정하다.)
* 권한 여부 확인

```
Authorization is the function of
 specifying access rights/privileges to resources,
  which is related to general information security and computer security,
   and to access control in particular.
    ( 접근 권한/특권, 특히 접근 제어를 지정하는 기능)
```


## 세션/토큰 비교

`<세션>`
* 서버측에서 저장/관리
* 유효기간,HttpOnly,Secure 옵션 주어 쿠키 저장
* 세션?
서버가 사용자의 정부를 저장해야헸고 이를 세션이라고 불렀다
대부분 세션을 메모리에 저장했고 로그인중 사용자가 많아지면서 db나 서버에 무리를 주었다.
https://mangkyu.tistory.com/55

`<토큰>`
* 웹 브라우저에 저장
* 세션보다 공격 노출 더 크다
* 되도록 민감한 정보를 담지 않도록 한다
* 만료 기간 설정 가능
* 토큰 주기가 짧을 때 refresh token 을 인증과정에 추가적으로 발급
[Refresh token 설명 영상](https://opentutorials.org/course/3405/22010)

# 실제로 적용한 방식

지금 사용하는 시스템은 JWT 기반의 인증을 사용합니다.
현재는 클라이언트에서 아이디,패스워드를 보내면 서버가 응답값으로 jwt token(aceess token ,refresh token) 을 보냅니다.
클라이언트는 로컬스트로지에 jwt token 을 저장하고 있으면
jwt 토큰은 주기 짧아 refresh token 도 같이 사용하고 있다.
https:/.outsider.ne.kr/1160
```
* ### [계정 service],[resource service],[client] 를 이용한 로그인
[실제 코드](2022-02-15-login-jwtTokenCreate/)

* ### [client] 로컬 을 실행하고 [service] 개발계 의 DB와 API 사용하기
일반적이진 않지만 화면 개발을 해야 하는데 서버 개발이 늦어져서 개발계에 서버와 연동해서 작업을 했었다.
(이때는 서버가 보내주는 json 값이 일치 했기 때문에 가능했다.)

> 1. [client]에 로그인 하면 아이디,패스워드로 jwt 토큰을 [계정 service] 에 요청합니다.
2. [계정 service]에서 jwt token 을 만들 때 [개발계의 JWT]랑 똑같도록 변경하는 작업 진행
3. [계정 service] 는 [개발계의 JWT]을 화면에 전달합니다.
4. 로그인한 사용자는 [개발계 서버의 API]를 조회할때 [개발계의 JWT]을 사용

```
# 참고
https://velog.io/@gusdnr814/%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%9D%B8%EC%A6%9D-4%EA%B0%80%EC%A7%80-%EB%B0%A9%EB%B2%95