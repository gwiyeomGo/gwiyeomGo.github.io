"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[2804],{2704:function(e,t,n){n.r(t),n.d(t,{Head:function(){return c.F},default:function(){return i}});var r=n(7294),a=n(1151);function l(e){const t=Object.assign({h3:"h3",p:"p",pre:"pre",code:"code",h1:"h1",ul:"ul",li:"li",ol:"ol",a:"a"},(0,a.ah)(),e.components);return r.createElement(r.Fragment,null,r.createElement(t.h3,null,"배경"),"\n",r.createElement(t.p,null,"회사의 입사,퇴사,인사변경이 자주 발생한다.\r\n담당자가 매번 입사,퇴사,인사변경 정보를 받아서 각각 매칭을 해줘야 한다.\r\n가끔 정보를 알지 못해서 매장 담당자에게 역할 매칭을 요청받는 문의도 생긴다."),"\n",r.createElement(t.p,null,"해당 업무를 자동화 하기 위해서\r\n매장 담당자가 매장과 역할 매칭을 요청하는 기능을 추가하기로 했다."),"\n",r.createElement(t.p,null,"매장과 역할 매칭 기능의 유형은 4가지로 보고 있다.\r\n1.인사이동\r\n2.입사\r\n3.퇴사\r\n4.매장 패점"),"\n",r.createElement(t.h3,null,"문제"),"\n",r.createElement(t.p,null,"요청 매칭 API 는어드민 화면 (웹) 에서 보내준 json 데이터를 받는다.\r\njson 을 bind 해서 validate 할 때 문제가 발생했다.\r\n요청을 하는 API 는 1개인데 필수로 하는 값이 유형에 따라 다르다."),"\n",r.createElement(t.h3,null,"초기 dto"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,'type MatchingRequest struct {\r\n\tType              string `json:"type" validate:"required"`\r\n\tRoleId            uint   `json:"role_id" validate:"required"`\r\n\tPreRoleId         uint   `json:"pre_role_id"`\r\n\t...\r\n}\r\n\r\nfunc (r MatchingRequest) Validate(ctx echo.Context) error {\r\n\tif r.Type == request.TypePersonnelChanges {\r\n\t\tif r.PreRoleId == uint(0) || r.PreOrganizationId == uint(0) {\r\n\t\t\treturn errors.New("인사이동의 경우 이전 역활과 조직을 선택은 필수입니다.")\r\n\t\t}\r\n\t}\r\n\treturn ctx.Validate(r)\r\n}\n')),"\n",r.createElement(t.p,null,r.createElement(t.code,null,"PreRoleId")," 의 경우 입사/퇴사에 필수로 필요하지 않다.\r\n하지만 인사이동 시 필수로 필요한 값이다."),"\n",r.createElement(t.p,null,"기존 코드에서는 리시버를 사용해서 값을 하나씩 확인하고 error 를 반환했다.\r\n문제는 Type 별 validate 가 계속 추가된다."),"\n",r.createElement(t.h1,null,"개선 방법"),"\n",r.createElement(t.ul,null,"\n",r.createElement(t.li,null,"커스텀 validate 를 사용해서 코드를 개선하자"),"\n"),"\n",r.createElement(t.h1,null,"방법"),"\n",r.createElement(t.ol,null,"\n",r.createElement(t.li,null,"framework  echo 를 사용시 설정\r\nEcho 에는 내장 된 데이터 유효성 검사 기능이 없기 때문에\r\n라이브러리 사용 설정해야 합니다."),"\n"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,'//import "github.com/labstack/echo"\r\n\r\ntype CustomValidator struct {\r\n\tValidator *validator.Validate\r\n}\r\n\r\nfunc (cv *CustomValidator) Validate(i interface{}) error {\r\n\treturn cv.Validator.Struct(i)\r\n}\r\n\r\nfunc main() {\r\n\te := echo.New()\r\n\te.Validator = &config.CustomValidator{Validator: validator.New()}\r\n}\n')),"\n",r.createElement(t.p,null,"이 코드처럼 validator 를 설정하지 않으면 ",r.createElement(t.code,null,"validator not registered")," 에러가 발생한다."),"\n",r.createElement(t.ol,{start:"2"},"\n",r.createElement(t.li,null,"golang 은 struct 는 filed tag 를 지정할 수 있다."),"\n"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,'func emptyCheckChild(fl validator.FieldLevel) bool {\r\n\tfmt.Println("INSIDE MY VALIDATOR")\r\n\tif value, ok := fl.Parent().Interface().(ParentStruct); ok {\r\n\t\tif value.Type == "B" {\r\n\t\t\tif reflect.ValueOf(value.Child).IsZero() {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true\r\n}\r\n\r\n\r\nfunc main() {\r\n\te := echo.New()\r\n    validator := validator.New()\r\n    validator.RegisterValidation("emptyCheckChild", emptyCheckChild)\r\n\te.Validator = &config.CustomValidator{Validator: validator}\r\n}\n')),"\n",r.createElement(t.h1,null,"tip"),"\n",r.createElement(t.p,null,"추가적으로 커스텀 tag 를 설정해 기능을 추가하는 방법"),"\n",r.createElement(t.h1,null,"출처"),"\n",r.createElement(t.p,null,r.createElement(t.a,{href:"https://medium.com/@apzuk3/input-validation-in-golang-bc24cdec1835"},"https://medium.com/@apzuk3/input-validation-in-golang-bc24cdec1835"),"\r\n",r.createElement(t.a,{href:"https://github.com/go-playground/validator"},"https://github.com/go-playground/validator"),"\r\n",r.createElement(t.a,{href:"https://pkg.go.dev/github.com/go-playground/validator#hdr-Baked_In_Validators_and_Tags"},"https://pkg.go.dev/github.com/go-playground/validator#hdr-Baked_In_Validators_and_Tags"),"\r\n",r.createElement(t.a,{href:"https://gist.github.com/NatGra/1972d860e1f4b7d2216813514431b1d9"},"https://gist.github.com/NatGra/1972d860e1f4b7d2216813514431b1d9"),"\r\n",r.createElement(t.a,{href:"https://gist.github.com/dakait/463ae4565405731f72e8857969036171"},"https://gist.github.com/dakait/463ae4565405731f72e8857969036171"),"\r\n",r.createElement(t.a,{href:"https://stackoverflow.com/questions/67273914/how-can-i-validate-a-struct-datatype-with-a-custom-validator"},"https://stackoverflow.com/questions/67273914/how-can-i-validate-a-struct-datatype-with-a-custom-validator"),"\r\n",r.createElement(t.a,{href:"https://go.dev/play/p/kZngZuDDSxW"},"https://go.dev/play/p/kZngZuDDSxW"),"\r\n",r.createElement(t.a,{href:"https://freshman.tech/snippets/go/check-empty-struct/"},"https://freshman.tech/snippets/go/check-empty-struct/")),"\n",r.createElement(t.p,null,r.createElement(t.a,{href:"https://gist.github.com/gwiyeomgo/b6edc70b87a8a638d1802dbafd7c8bff"},"https://gist.github.com/gwiyeomgo/b6edc70b87a8a638d1802dbafd7c8bff")))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?r.createElement(t,e,r.createElement(l,e)):l(e)},c=n(8804);function i(e){return r.createElement(c.Z,e,r.createElement(o,e))}c.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-golang-2022-12-29-go-struct-validate-mdx-93fda4e635b37fcae283.js.map