"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[1154],{4347:function(e,t,r){r.r(t),r.d(t,{Head:function(){return s.F},default:function(){return i}});var n=r(7294),l=r(1151);function a(e){const t=Object.assign({h3:"h3",ul:"ul",li:"li",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",p:"p",pre:"pre",code:"code"},(0,l.ah)(),e.components);return n.createElement(n.Fragment,null,n.createElement(t.h3,null,"배경"),"\n",n.createElement(t.ul,null,"\n",n.createElement(t.li,null,"applications table"),"\n"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"contents"),n.createElement(t.th,null,"상태"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"테스트1"),n.createElement(t.td,null,"Saved")),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"테스트2"),n.createElement(t.td,null,"Registered")),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"테스트3"),n.createElement(t.td,null,"Approved")))),"\n",n.createElement(t.ul,null,"\n",n.createElement(t.li,null,"reports table"),"\n"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"contents"),n.createElement(t.th,null,"상태"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"테스트1"),n.createElement(t.td,null,"Saved")),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"테스트2"),n.createElement(t.td,null,"Registered")),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"테스트3"),n.createElement(t.td,null,"Rejected")))),"\n",n.createElement(t.p,null,"모든 상태 값"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"상태"),n.createElement(t.th,null,"한글"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"Saved"),n.createElement(t.td,null,"임시저장")),n.createElement(t.tr,null,n.createElement(t.td,null,"Registered"),n.createElement(t.td,null,"신청")),n.createElement(t.tr,null,n.createElement(t.td,null,"Reworked"),n.createElement(t.td,null,"재작업")),n.createElement(t.tr,null,n.createElement(t.td,null,"Approved"),n.createElement(t.td,null,"승인")),n.createElement(t.tr,null,n.createElement(t.td,null,"Rejected"),n.createElement(t.td,null,"반려")),n.createElement(t.tr,null,n.createElement(t.td,null,"Rejected"),n.createElement(t.td,null,"반려")))),"\n",n.createElement(t.p,null,"기관에는 여러명의 소속 직웝이 있다.\n기관은 물품을 선택할 수 있다."),"\n",n.createElement(t.p,null,"신청의 상태가 Registered,reworked,approved 이고\n보고서의 상태가 Registered,Approved 이면\n해당 기관의 담당자는 물품을 신청할 수 있다."),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"POST"),n.createElement(t.th,null,"PUT"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"입력값이 승인된 기관인지 확인"),n.createElement(t.td)),n.createElement(t.tr,null,n.createElement(t.td,null,"입력값이 승인된 물품인지 확인"),n.createElement(t.td)),n.createElement(t.tr,null,n.createElement(t.td,null,"입력값이 사업분야가 물품의 사업분야와 일치하는지 확인"),n.createElement(t.td,null,"신청이 존재하는지 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"기관,물품으로 신청된 내용 있는지 확인,없다"),n.createElement(t.td,null,"신청된 데이터의 기관과 신청서의 기관이 일치하는지 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"입력값이 등록을 원하면,신청 가능한지 확인"),n.createElement(t.td,null,"입력값이 등록을 원하면,신청 가능한지 확인")))),"\n",n.createElement(t.pre,null,n.createElement(t.code,null,'\nfunc (s *ApplicationCUD) validateForCreation(c echo.Context) error {\n\tcontext.Log(c).Traceln("")\n\n\torg := internal.Org{Id: s.OrgId, Status: enum.Approved.String()}\n\tif b, err := org.GetOne(c); err != nil {\n\t\treturn err\n\t} else if !b {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNoDataFound+"(단체:%d)", s.OrgId))\n\t}\n\n\tgoods := internal.Goods{Id: s.GoodsId, Status: enum.Registered.String()}\n\tif b, err := goods.GetOne(c); err != nil {\n\t\treturn err\n\t} else if !b {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNoDataFound+"(물품개설:%d)", s.GoodsId))\n\t} else if goods.Expired || goods.Closed {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNotAvailable+"(물품개설:%d)", s.GoodsId))\n\t}\n\n\tif goods.BusinessField != "*" && org.BusinessField != goods.BusinessField {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(사업분야:%d)", org.BusinessField))\n\t} else if goods.BusinessRegion != "00" && org.BusinessRegion != goods.BusinessRegion {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(지역:%d)", org.BusinessRegion))\n\t}\n\n\tapplications := internal.Application{OrgId: s.OrgId, GoodsId: s.GoodsId}\n\tif results, err := applications.GetList(c); err != nil {\n\t\treturn err\n\t} else if len(*results) > 0 {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageExist + "(신청)"))\n\t}\n\n\tif s.Status == enum.Registered.String() {\n\t\tavailable, err := ApplicationRepository{}.IsApplicationAvailable(c, s.OrgId, 0)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t} else if !available {\n\t\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageExist+"(단체:%d)", s.OrgId))\n\t\t}\n\t}\n\n\treturn nil\n}\n\nfunc (s *ApplicationCUD) validateForUpdating(c echo.Context) error {\n\tcontext.Log(c).Traceln("")\n\n\torg := internal.Org{Id: s.OrgId, Status: enum.Approved.String()}\n\tif b, err := org.GetOne(c); err != nil {\n\t\treturn err\n\t} else if !b {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNoDataFound+"(단체:%d)", s.OrgId))\n\t}\n\n\tgoods := internal.Goods{Id: s.GoodsId, Status: enum.Registered.String()}\n\tif b, err := goods.GetOne(c); err != nil {\n\t\treturn err\n\t} else if !b {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNoDataFound+"(물품개설:%d)", s.GoodsId))\n\t} else if goods.Expired || goods.Closed {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNotAvailable+"(물품개설:%d)", s.GoodsId))\n\t}\n\n\tif goods.BusinessField != "*" && org.BusinessField != goods.BusinessField {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(사업분야:%d)", org.BusinessField))\n\t} else if goods.BusinessRegion != "00" && org.BusinessRegion != goods.BusinessRegion {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(지역:%d)", org.BusinessRegion))\n\t}\n\n\tapplication := internal.Application{Id: s.Id}\n\tif b, err := application.GetOne(c); err != nil {\n\t\treturn err\n\t} else if !b {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageNoDataFound+"(단체:%d)", s.OrgId))\n\t}\n\n\tif application.OrgId != s.OrgId {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(단체:%d)", s.OrgId))\n\t} else if application.GoodsId != s.GoodsId {\n\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageParamsNotSame+"(물품개설:%d)", s.GoodsId))\n\t}\n\n\tif s.Status == enum.Registered.String() {\n\t\tavailable, err := ApplicationRepository{}.IsApplicationAvailable(c, s.OrgId, s.Id)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t} else if !available {\n\t\t\treturn errors.ApiInternalServerError(fmt.Sprintf(errors.MessageExist+"(단체:%d)", s.OrgId))\n\t\t}\n\t}\n\n\treturn nil\n}\n')),"\n",n.createElement(t.pre,null,n.createElement(t.code,null,'func (ApplicationRepository) IsApplicationAvailable(c echo.Context, orgID int64, id int64) (bool, error) {\n\tcontext.Log(c).Traceln("")\n\n\tapplicationStatus := []string{enum.Registered.String(), enum.Reworked.String(), enum.Approved.String()}\n\tbuilder := context.DB(c).Table("applications").Where("del is null or del = 0").In("status", applicationStatus)\n\tif orgID != 0 {\n\t\tbuilder = builder.And("org_id = ?", orgID)\n\t}\n\tif id != 0 {\n\t\tbuilder = builder.And("id !=?", id)\n\t}\n\n\tvar applications []map[string]string\n\tif err := builder.Find(&applications); err != nil {\n\t\tcontext.Log(c).Errorln(err.Error())\n\t\treturn false, errors.ApiInternalServerError(err.Error())\n\t}\n\n\treportStatus := []string{enum.Registered.String() enum.Reworked.String(), enum.Approved.String()}\n\treport := context.DB(c).Table("reports").Where("del is null or del = 0").And("org_id = ?", orgID).In("status", reportStatus)\n\tif id != 0 {\n\t\treport.And("application_id !=?", id)\n\t}\n\tvar reports []map[string]string\n\tif err := report.Find(&reports); err != nil {\n\t\tcontext.Log(c).Errorln(err.Error())\n\t\treturn false, errors.ApiInternalServerError(err.Error())\n\t}\n\n\tif len(applications) == len(reports) {\n\t\treturn true, nil\n\t}\n\n\treturn false, nil\n}\n')))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.ah)(),e.components);return t?n.createElement(t,e,n.createElement(a,e)):a(e)},s=r(8804);function i(e){return n.createElement(s.Z,e,n.createElement(o,e))}s.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-network-rest-2022-05-03-rest-compare-row-count-of-two-tables-mdx-248d3be28871e1f6c972.js.map