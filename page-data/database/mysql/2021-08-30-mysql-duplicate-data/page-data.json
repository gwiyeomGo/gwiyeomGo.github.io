{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/database/mysql/2021-08-30-mysql-duplicate-data","result":{"data":{"post":{"slug":"/database/mysql/2021-08-30-mysql-duplicate-data","title":"mysql 중복 데이터 처리 경험 (mysql delete 기능,중복 데이터 조회)","date":"30.08.2021","tags":[{"name":"MYSQL","slug":"mysql"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"mysql 중복 데이터 처리 경험 (mysql delete 기능,중복 데이터 조회)\",\n  \"date\": \"2021-08-30T00:00:00.000Z\",\n  \"slug\": \"/database/mysql/2021-08-30-mysql-duplicate-data\",\n  \"tags\": [\"MYSQL\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"\\uBC30\\uACBD\"), mdx(\"p\", null, \"\\uC2E4\\uC81C \\uAE30\\uBD80\\uB370\\uC774\\uD130\\uB294 1\\uAC1C\\uC774\\uACE0, \\uAE30\\uBD80\\uBAA9\\uB85D\\uC5D0\\uB294 2\\uAC1C\\uB85C \\uBCF4\\uC774\\uB294 \\uBB38\\uC81C\\uAC00 \\uBC1C\\uC0DD\\uD588\\uB2E4.\\n\\uAE30\\uBD80 \\uD14C\\uC774\\uBE14\\uACFC \\uAE30\\uBD80 \\uC601\\uC218\\uC99D\\uC740 left \\uC870\\uC778\\uC744 \\uD574\\uC11C \\uB370\\uC774\\uD130\\uB97C \\uC870\\uD68C\\uD569\\uB2C8\\uB2E4.\\n\\uBB38\\uC81C\\uB294 \\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uB370\\uC774\\uD130\\uAC00 2\\uAC1C\\uC5EC\\uC11C \\uBAA9\\uB85D\\uC5D0\\uB3C4 2\\uAC1C\\uB85C \\uBCF4\\uC785\\uB2C8\\uB2E4.\"), mdx(\"p\", null, \"\\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uB370\\uC774\\uD130\\uB97C \\uC0AD\\uC81C\\uD558\\uACE0 , \\uD14C\\uC774\\uBE14\\uC5D0 1\\uAC1C\\uB9CC \\uB4E4\\uC5B4\\uAC00\\uB3C4\\uB85D \\uC81C\\uC57D\\uC744 \\uC124\\uC815\\uD558\\uAE30\\uB85C \\uD588\\uACE0\\n\\uC218\\uC815\\uC791\\uC5C5\\uC744 \\uC704\\uD574 \\uB370\\uC774\\uD130\\uB97C \\uC870\\uD68C\\uD588\\uC2B5\\uB2C8\\uB2E4.\"), mdx(\"h3\", null, \"donation_receipts table \\uC744 \\uBCF4\\uB2C8\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"id 4,6\\uBC88\\uC740 \\uAC19\\uC740 donation_id\\uAC00 \\uC874\\uC7AC\\uD55C\\uB2E4\")), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"id\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"nationality_type\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"name\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"donation_id\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NATIVE\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"A\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"17\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NATIVE\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"B\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"16\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"3\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NATIVE\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"C\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"14\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NATIVE\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"D\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"22\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"5\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NATIVE\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"D\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"...\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"22\")))), mdx(\"h1\", null, \"(1) \\uC911\\uBCF5\\uB41C \\uB370\\uC774\\uD130 \\uCC3E\\uAE30\"), mdx(\"h3\", null, \"\\uC911\\uBCF5\\uB41C \\uB370\\uC774\\uD130\\uAC00 \\uC874\\uC7AC\\uD558\\uB294 \\uAE30\\uBD80\\uAC74 \\uC218 \\uD655\\uC778 \\uCFFC\\uB9AC\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, \"SELECT * FROM donation_receipts  GROUP BY donation_id HAVING count(*) > 1;\\n\")), mdx(\"p\", null, \"*GROUP BY \\uC808 \\uC0AC\\uC6A9\\uD558\\uAE30, HAVING\\uC808 \\uC548\\uC5D0 COUNT \\uD568\\uC218 \\uC0AC\\uC6A9\\uD558\\uAE30\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://stackoverflow.com/questions/16697215/count-number-of-unique-values\"\n  }, \"\\uCC38\\uC870\")), mdx(\"h3\", null, \"\\uC911\\uBCF5\\uB41C \\uAE30\\uBD80\\uBC88\\uD638\\uB97C \\uAC16\\uC740 \\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uC870\\uD68C \\uCFFC\\uB9AC\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, \"select * from donation_receipts\\nwhere donation_id in (\\n    SELECT donation_id FROM donation_receipts  GROUP BY donation_id HAVING count(*) > 1 -- \\uC911\\uBCF5\\uB41C \\uAE30\\uBD80\\uBC88\\uD638 22\\n)\\n\\n\")), mdx(\"h1\", null, \"(2) \\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uB370\\uC774\\uD130\\uB97C \\uC0AD\\uC81C - \\uB370\\uC774\\uD130 \\uC815\\uC81C \\uC791\\uC5C5\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, \"START TRANSACTION;\\n-- \\uC544\\uB798 \\uCFFC\\uB9AC\\uB85C \\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uBAA9\\uB85D\\uC758 donation_id \\uAC00 \\uC911\\uBCF5\\uC778 \\uACBD\\uC6B0 id \\uAC12\\uC774 \\uC791\\uC740 \\uACBD\\uC6B0\\uB97C \\uC0AD\\uC81C\\uD558\\uAE30\\uB85C\\uD568\\nDELETE\\n-- select *\\nfrom donation_receipts\\n    -- \\uB610 \\uC11C\\uBE0C\\uCFFC\\uB77C\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uC774\\uC720\\uB294\\n    -- Error Code: 1093. You can't specify target table 'donation_receipts' for update in FROM clause   0.000 sec \\uBC1C\\uC0DD\\uD588\\uC5C8\\uC74C\\n    -- MySQL\\uC5D0\\uC11C UPDATE & DELETE \\uB97C \\uD560 \\uB54C \\uC790\\uAE30 \\uD14C\\uC774\\uBE14\\uC758 \\uB370\\uC774\\uD130\\uB97C \\uBC14\\uB85C \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uBABB\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC11C\\uBE0C\\uCFFC\\uB9AC\\uB97C \\uD558\\uB098 \\uB354 \\uC0AC\\uC6A9\\uD55C\\uB2E4.\\nwhere id in (\\n    select k.id from (\\n        select x.id\\n        from(select * from donation_receipts where donation_id in ( SELECT donation_id FROM donation_receipts  GROUP BY donation_id HAVING count(*) > 1 )) x\\n        --\\uC911\\uBCF5\\uB41C \\uAE30\\uBD80\\uBC88\\uD638\\uB97C \\uAC16\\uC740 \\uAE30\\uBD80\\uC601\\uC218\\uC99D id \\uBAA9\\uB85D\\uC5D0\\uC11C\\n        where x.id != (select max(id) from donation_receipts y where y.donation_id=x.donation_id)) k\\n        -- id \\uAC12\\uC774 max \\uAC00 \\uC544\\uB2CC \\uACBD\\uC6B0\\uC758 \\uAE30\\uBD80\\uC601\\uC218\\uC99D id\\n);\\n\\n-- \\uC81C\\uB300\\uB85C \\uC0AD\\uC81C\\uB418\\uC5C8\\uB290\\uC9C0 \\uD655\\uC778\\nselect *\\nfrom donation_receipts\\nwhere donation_id in (SELECT donation_id FROM donation_receipts GROUP BY donation_id HAVING count(*) > 1);\\n\\ncommit;\\n-- rollback;\\n\")), mdx(\"h1\", null, \"(3) \\uAE30\\uBD80\\uC601\\uC218\\uC99D \\uD14C\\uC774\\uBE14\\uC758 donation_id \\uCEEC\\uB7FC\\uC5D0 unique \\uC124\\uC815\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/content/img/unique.JPG\",\n    \"alt\": \"image.png\"\n  })), mdx(\"h1\", null, \"\\uCC38\\uACE0\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://velog.io/@khnn/TIL-DELETE%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%9C%EB%B8%8C%EC%BF%BC%EB%A6%AC-%ED%99%9C%EC%9A%A9\"\n  }, \"UPDATE & DELETE \\uB97C \\uD560 \\uB54C \\uC790\\uAE30 \\uD14C\\uC774\\uBE14\\uC758 \\uB370\\uC774\\uD130\\uB97C \\uBC14\\uB85C \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uBABB\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC11C\\uBE0C\\uCFFC\\uB9AC\\uB97C \\uD558\\uB098 \\uB354 \\uC0AC\\uC6A9\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"배경 실제 기부데이터는 1개이고, 기부목록에는 2개로 보이는 문제가 발생했다.\n기부 테이블과 기부 영수증은 left 조인을 해서 데이터를 조회합니다.\n문제는 기부영수증 데이터가 2개여서 목록에도…","timeToRead":1,"banner":null}},"pageContext":{"slug":"/database/mysql/2021-08-30-mysql-duplicate-data","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["2744905544","3090400250","318001574"]}