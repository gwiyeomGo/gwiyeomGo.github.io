"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[5696],{1530:function(e,t,l){l.r(t),l.d(t,{Head:function(){return c.F},default:function(){return d}});var n=l(7294),a=l(1151);function r(e){const t=Object.assign({h3:"h3",p:"p",pre:"pre",code:"code",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",a:"a"},(0,a.ah)(),e.components);return n.createElement(n.Fragment,null,n.createElement(t.h3,null,"배경"),"\n",n.createElement(t.p,null,"지금 개발하는 시스템을 100개 매장에서 사용한다\r\n각 매장에서 한번이라도 시스템을 사용한 회원의 정보가 필요하다\r\n그래서\r\n매장에서 해당 시스템을 사용한 회원의\r\n매장코드,회원id,일시를 기록하는 table을 생성하기로 했다"),"\n",n.createElement(t.h3,null,"추가된 table"),"\n",n.createElement(t.pre,null,n.createElement(t.code,null,"-- mysql 기준\r\nCREATE TABLE IF NOT EXISTS `member_sites`\r\n(\r\n    `id`             INT          NOT NULL AUTO_INCREMENT,\r\n    `member_id`      INT          NOT NULL COMMENT '회원 번호',\r\n    `code`           VARCHAR(10)  NOT NULL,\r\n    `created`        JSON         NOT NULL COMMENT '처음 사용 일자',\r\n    `updated`        JSON         NOT NULL COMMENT '최근 사용 일자',\r\n    `deleted_at`     DATETIME     NULL,\r\n    PRIMARY KEY (`id`),\r\n    INDEX idx_member_id_site_code (member_id DESC, site_code ASC)\r\n);\n")),"\n",n.createElement(t.h3,null,"기존에 방문했던 회원의 기록은 어떻하지?"),"\n",n.createElement(t.h3,null,"신청 table"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"member_id"),n.createElement(t.th,null,"..."),n.createElement(t.th,null,"name"),n.createElement(t.th,null,"code"),n.createElement(t.th,null,"created"),n.createElement(t.th,null,"updated"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"3"),n.createElement(t.td,null,"..."),n.createElement(t.td,null,"a"),n.createElement(t.td,null,"100"),n.createElement(t.td,null,n.createElement(t.code,null,'{id":4,"name":manager,"role":"manager","datetime":"2022-02-05 09:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{id": 4 ,"name":manager,"role":"manager","datetime":"2022-02-06 09:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"..."),n.createElement(t.td,null,"c"),n.createElement(t.td,null,"200"),n.createElement(t.td,null,n.createElement(t.code,null,'{id":4,"name":manager,"role":"manager","datetime":"2022-02-05 10:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{id": 4 ,"name":manager,"role":"manager","datetime":"2022-02-05 10:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"..."),n.createElement(t.td,null,"b"),n.createElement(t.td,null,"300"),n.createElement(t.td,null,n.createElement(t.code,null,'{id":4,"name":manager,"role":"manager","datetime":"2022-02-05 13:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{id": 4 ,"name":manager,"role":"manager","datetime":"2022-02-06 09:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"4"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"..."),n.createElement(t.td,null,"c"),n.createElement(t.td,null,"200"),n.createElement(t.td,null,n.createElement(t.code,null,'{id":4,"name":manager,"role":"manager","datetime":"2022-02-05 12:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{id": 4 ,"name":manager,"role":"manager","datetime":"2022-02-05 12:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"5"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"..."),n.createElement(t.td,null,"b"),n.createElement(t.td,null,"300"),n.createElement(t.td,null,n.createElement(t.code,null,'{id":4,"name":manager,"role":"manager","datetime":"2022-02-05 09:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{id": 4 ,"name":manager,"role":"manager","datetime":"2022-02-06 09:05:03"}'))))),"\n",n.createElement(t.p,null,"회원번호 3번은 code 가 100번인 매장에 방문하고 신청\r\n회원은 여러 매장에서 신청 가능하다"),"\n",n.createElement(t.h3,null,"마이그레이션"),"\n",n.createElement(t.p,null,"한 회원이 신청건중 최초로 신청한 신청건의 일자를 created에 추가"),"\n",n.createElement(t.h3,null,"If we were to group by two columns:"),"\n",n.createElement(t.h3,null,"test Table"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"member_id"),n.createElement(t.th,null,"code"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"3"),n.createElement(t.td,null,"100")),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"200")),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"200")),n.createElement(t.tr,null,n.createElement(t.td,null,"4"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"200")),n.createElement(t.tr,null,n.createElement(t.td,null,"5"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"300")))),"\n",n.createElement(t.pre,null,n.createElement(t.code,null,"select  min(id) minid,code, member_id,\r\n      from test \r\n      group by member_id, code\n")),"\n",n.createElement(t.h3,null,"member_id,code 를 group by 결과 ,id 는 최소값 즉"),"\n",n.createElement(t.p,null,"각 매장에 회원이 최초 방문한 경우"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"member_id"),n.createElement(t.th,null,"code"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"3"),n.createElement(t.td,null,"100")),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"200")),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"200")),n.createElement(t.tr,null,n.createElement(t.td,null,"5"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"300")))),"\n",n.createElement(t.p,null,"각 매장에 회원이 최초 방문한 경우 시간 = created,updated\r\n각 매장에 회원이 최초 방문한 경우를 member_sites 에 넣어준다."),"\n",n.createElement(t.pre,null,n.createElement(t.code,null,"INSERT INTO member_sites(member_id, code, created, updated)\r\nSELECT  d.id ,d.member_id, d.code,d.created, d.created as updated\r\nFROM test d inner join\r\n(select a.code, a.member_id, min(a.id) minid\r\nfrom test a\r\ngroup by a.member_id, a.code) a\r\non d.member_id =a.member_id\r\nand d.code =a.code\r\nand d.id = a.minid;\r\n\n")),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"id"),n.createElement(t.th,null,"member_id"),n.createElement(t.th,null,"code"),n.createElement(t.th,null,"created"),n.createElement(t.th,null,"updated"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"1"),n.createElement(t.td,null,"3"),n.createElement(t.td,null,"100"),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 09:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 09:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"2"),n.createElement(t.td,null,"1"),n.createElement(t.td,null,"200"),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 10:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 10:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"3"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"200"),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 11:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 11:05:03"}'))),n.createElement(t.tr,null,n.createElement(t.td,null,"5"),n.createElement(t.td,null,"2"),n.createElement(t.td,null,"300"),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 09:05:03"}')),n.createElement(t.td,null,n.createElement(t.code,null,'{"id":4,"name":"manager","role":"manager","datetime":"2022-02-05 09:05:03"}'))))),"\n",n.createElement(t.p,null,n.createElement(t.a,{href:"https://replit.com/@gwiyeomgo/migration20220206"},"sqlite  실습링크")))}var m=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?n.createElement(t,e,n.createElement(r,e)):r(e)},c=l(4502);function d(e){return n.createElement(c.Z,e,n.createElement(m,e))}c.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-c-github-gwiyeomgo-github-io-content-posts-server-database-mysql-2022-02-06-mysql-unique-key-mdx-ef48af68340ce88730f9.js.map