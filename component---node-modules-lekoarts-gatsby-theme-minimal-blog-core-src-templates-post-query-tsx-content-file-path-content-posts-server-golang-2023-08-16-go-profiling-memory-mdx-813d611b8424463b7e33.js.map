{"version":3,"file":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-golang-2023-08-16-go-profiling-memory-mdx-813d611b8424463b7e33.js","mappings":"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","sources":["webpack://gwiyeom-blog/./content/posts/server/golang/2023-08-16-go-profiling-memory.mdx","webpack://gwiyeom-blog/./node_modules/@lekoarts/gatsby-theme-minimal-blog-core/src/templates/post-query.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    a: \"a\",\n    h3: \"h3\",\n    code: \"code\",\n    blockquote: \"blockquote\",\n    pre: \"pre\",\n    ul: \"ul\",\n    li: \"li\",\n    ol: \"ol\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.h1, null, \"배경\"), \"\\n\", React.createElement(_components.p, null, \"인프라팀에서 자체적으로 apm 을 만들었고\\n실행결과 특정 서비스가 메모리를 많이 사용하고 있다고 알게되었다\\n고쳐야하는데\\n어디서 많이 누수가 발생하는지 모르겠다\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://www.nylas.com/blog/finding-memory-leak-in-go-service-dev/\"\n  }, \"링크1\"), \"\\n를 통해 어디에서 메모리를 많이 사용할 수 있는지 알 수 잇다고 한다\"), \"\\n\", React.createElement(_components.h1, null, \"Profile 정보 수집\"), \"\\n\", React.createElement(_components.h3, null, \"(1) \\\"net/http/pprof\\\"\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://ssup2.github.io/programming/Golang_Profiling/?ref=pangyoalto.com\"\n  }, \"http.HandleFunc 으로 핸들러를 구현한 경우\"), \"를 인터넷에서 봤고 지금사용하는\\nehco 프레임워크에 적용하는 방법\\n\", React.createElement(_components.code, null, \"e.GET(\\\"/debug/pprof/*\\\", echo.WrapHandler(http.DefaultServeMux))\"), \" 를 추가\"), \"\\n\", React.createElement(_components.blockquote, null, \"\\n\", React.createElement(_components.p, null, \"Profile File 정보 얻기\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"CPU 정보\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \"curl http://localhost:8080/debug/pprof/profile > profile.pprof\\n\")), \"\\n\", React.createElement(_components.p, null, \"Memory Heap 정보\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \"curl http://localhost:8080/debug/pprof/heap > heap.pprof\\n\")), \"\\n\", React.createElement(_components.p, null, \"모든 HTTP Endpoint에 seconds Query String를 이용하면 몇 초 동안 Profiling을 수행할지 설정\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \" curl http://localhost:8080/debug/pprof/trace\\\\?seconds\\\\=30 --output trace.out\\n\")), \"\\n\", React.createElement(_components.h3, null, \"(2) \", React.createElement(_components.a, {\n    href: \"https://ssup2.github.io/programming/Golang_Profiling/?ref=pangyoalto.com\"\n  }, \"다른방법들..\")), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"runtime/pprof Package\"), \" , \", React.createElement(_components.code, null, \"Unit Test\"), \" 등등..\"), \"\\n\", React.createElement(_components.h1, null, \"Profile 시각화 보기\"), \"\\n\", React.createElement(_components.p, null, \"pprof 도구로 profile 파일을 다운받기\\n\", React.createElement(_components.code, null, \"go tool pprof [-http옵션][Profile File]\")), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"go tool pprof heap.pprof\"), \"\\n\", React.createElement(_components.code, null, \"go tool pprof -http :8080 heap.pprof\"), \"\\n\", React.createElement(_components.code, null, \"go tool pprof http://0.0.0.0:8080/debug/pprof/heap\")), \"\\n\", React.createElement(_components.p, null, \"커맨드를 사용해 시각화 해서 볼 수 있음\\ngraphviz 그래프 기반의 dot 파일로 기술된 다양한 이미지를 쉽게 시각화할 수 있는 패키지\\ngraphviz 설치해야 시각화된 정보를 얻을 수 있음\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"mac 에서 다운받기\\n\", React.createElement(_components.code, null, \"brew install graphviz\")), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"command 에서 아래 명령어로 분석가능\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"(prof) web\"), \"\\n커멘드 창에 web 을 입력시 web 에서 그래프를 볼 수 있음\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"(pprof) png\"), \" => 이미지 생성해서 받을 수 있음\\nGenerating report in profile001.png\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"(pprof) top15\")), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"수집한 profile data 시각화\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"180초 동안 수집한 profile data 다운\\n\", React.createElement(_components.code, null, \"curl http://localhost:8080/debug/pprof/profile\\\\?seconds\\\\=180 --output profile.out\")), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"go tool pprof -http localhost:9090 profile.out\")), \"\\n\", React.createElement(_components.p, null, \"=> 해당 명령을 실행하면 web 에서 view > top 에서  CPU 사용률이 높은 함수를 순서를 보여준다\"), \"\\n\", React.createElement(_components.ol, {\n    start: \"2\"\n  }, \"\\n\", React.createElement(_components.li, null, \"수집한 profile trace 보기\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"curl http://localhost:8080/debug/pprof/trace\\\\?seconds\\\\=180 --output trace.out\"), \"\\n9090 포트로 실행\\n\", React.createElement(_components.code, null, \"go tool trace -http localhost:9090 trace.out\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 924px; \\\"\\n    >\\n      <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 89.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVR42n2U6ZaiQAyFff8nszeXRkQFFAQFxXW0XXrL8IUJQ/9pz7knSxWpJDexNZ9HMhw6EseRjEYj8X1fgiCQyWQi4/FYwjCU7+/vX9H8teJ4J66byWQcSJomst1uZbVayXq9Vj3Pc9lsNrLf72scj0fZ7Xa1/fHx8T9gGCbieaFmF4aBzOdzzXI6naqPD/l9fX39yArb8CPD6/Uiq2QjxXIv1+tVbrebXC4XeXt7k/P5LPf7XT/6/Pz8FRa4FUWROM5ARt5Iewbon+d5ZW+HKgeDQe0na0Oz1zxeB/SDqkQODbPZrPbRgqIotK/0E2DTDtNPp1MVkAza7bb0ej15fHyUp6cneXl5kefnZ/U9PDzUNufdbleBjb/T6ajONFB2K01TLQuQDWVwSFaWnZVmOiBbMiNDWKfXkNXKskwomxKRsExAbCQ2fnRkHMfaCiRn3CMpHtCAvEwJrutqif1+X+Xr6+sPCSxLG3iIgThsEvs32LFe4kJNjG9bEtQlgiRJFMvlUgfeQDDK1x7ykTfyFH4ZiEyH7lAGjivesOotPkYHoOOzrAxsjAaE+mg2lzRZllhIsS5klW6lyPayyQ6SZ2vJV7lmxUoybywAYPhtGepNgaE4WEjkL0q5LGeL/dzJ4XDQOUMauIts7jSSneeukjItWXIGTrktZfP7XZ0tCHAcR+cLkiCtIqfSjTh05pAWwIWWDO2Q8n5/11kifYBudlNvwnzNP4gWrMGgNZdemVwsFrWfWUvTPyWrZU/zTNltnlO6BoQtyrQy0CnPBpoHqaJCNcw21HaODWH08C/+VC110RIgZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"img\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/275044a153e5f0b30350db08a0b58aa1/e5e56/go_trace_ex.png\\\"\\n        srcset=\\\"/static/275044a153e5f0b30350db08a0b58aa1/5243c/go_trace_ex.png 240w,\\n/static/275044a153e5f0b30350db08a0b58aa1/ab158/go_trace_ex.png 480w,\\n/static/275044a153e5f0b30350db08a0b58aa1/e5e56/go_trace_ex.png 924w\\\"\\n        sizes=\\\"(max-width: 924px) 100vw, 924px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n    </span>\"\n    }\n  })), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://pangyoalto.com/go-using-pprof-for-profiing/\"\n  }, \"링크2\")), \"\\n\", React.createElement(_components.h1, null, \"분석\"), \"\\n\", React.createElement(_components.h3, null, \"(Flat,cum )[\", React.createElement(_components.a, {\n    href: \"https://ssup2.github.io/programming/Golang_Profiling/\"\n  }, \"https://ssup2.github.io/programming/Golang_Profiling/\"), \"]\"), \"\\n\", React.createElement(_components.p, null, \"flat is duration spent on given a function and\\ncum is cumulative of current function plus calls above it\"), \"\\n\", React.createElement(_components.p, null, \"Flat은 함수가 직접적으로 수행하는 Action의 부하\\nCum은 함수가 실행되기 위한 모든 Action의 부하\"), \"\\n\", React.createElement(_components.p, null, \"sum% could help you to identify the big rocks quickly. The following is another example of memory allocation report.\\nsum% = 메모리 사용률\\n메모리 사용률(sum) 이 100% 가 되지 않는 상황\"), \"\\n\", React.createElement(_components.p, null, \"누수는 프로그램이 더 이상 필요하지 않은 메모리를 해제하지 않아 발생하며, 이로 인해 메모리 사용량이 계속해서 증가..\\n\", React.createElement(_components.a, {\n    href: \"https://stackoverflow.com/questions/32571396/pprof-and-golang-how-to-interpret-a-results\"\n  }, \"https://stackoverflow.com/questions/32571396/pprof-and-golang-how-to-interpret-a-results\"), \"\\n\", React.createElement(_components.a, {\n    href: \"https://ssup2.github.io/programming/Golang_Profiling/\"\n  }, \"https://ssup2.github.io/programming/Golang_Profiling/\")), \"\\n\", React.createElement(_components.p, null, \"출력된 그래프를 읽는방법\\n\", React.createElement(_components.a, {\n    href: \"https://github.com/google/pprof/blob/main/doc/README.md#interpreting-the-callgraph\"\n  }, \"https://github.com/google/pprof/blob/main/doc/README.md#interpreting-the-callgraph\")), \"\\n\", React.createElement(_components.p, null, \"--\\n질문.. 로컬에서는 실행해서 데이터를 확인했는데..\\n인프라 담당자분이 개발계 터미널에서 localhost 로 실행해서 파일을 생성했다\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://github.com/google/gops\"\n  }, \"https://github.com/google/gops\"), \"\\n\", React.createElement(_components.a, {\n    href: \"https://pangyoalto.com/go-using-pprof-for-profiing/\"\n  }, \"https://pangyoalto.com/go-using-pprof-for-profiing/\"), \"\\n\", React.createElement(_components.a, {\n    href: \"https://ssup2.github.io/programming/Golang_Profiling/?ref=pangyoalto.com\"\n  }, \"https://ssup2.github.io/programming/Golang_Profiling/?ref=pangyoalto.com\")));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import React from \"react\";\nimport GATSBY_COMPILED_MDX from \"/home/runner/work/gwiyeomgo.github.io/gwiyeomgo.github.io/content/posts/server/golang/2023-08-16-go-profiling-memory.mdx\";\nimport PostComponent, {Head} from \"../components/post\";\nPostComponent\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostComponent, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nexport {Head};\nconst query = \"2040642971\";\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","p","a","h3","code","blockquote","pre","ul","li","ol","span","_provideComponents","components","React","href","start","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","GatsbyMDXWrapper","PostComponent","GATSBY_COMPILED_MDX"],"sourceRoot":""}