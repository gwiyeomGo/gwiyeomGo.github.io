"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[3706],{483:function(e,n,t){t.r(n),t.d(n,{Head:function(){return o.F},default:function(){return E}});var l=t(7294),c=t(1151);function r(e){const n=Object.assign({h3:"h3",p:"p",pre:"pre",code:"code",ul:"ul",li:"li",a:"a",blockquote:"blockquote"},(0,c.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement(n.h3,null,"배경"),"\n",l.createElement(n.p,null,"어드민 서비스 와 기부 서비스는 분리되어 있습니다.\r\n어드민 서비스에 조직도"),"\n",l.createElement(n.h3,null,"개선 내용"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,'|id|name|connect|\r\n|---|---|---|\r\n|1|강동|{"code":"200122"}\'|\r\n\n')),"\n",l.createElement(n.h3,null,"json data 를 replace 해서 조회하기"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"기존의 connect 컬럼의 json string 데이터의 code key 값을 변경"),"\n"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"select id, name, json_replace(connect, '$.code', \"300123\") from employees where id = 1;\n")),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,'|id|name|connect|\r\n|---|---|---|\r\n|1|강동|\'{"code":"300123"}\'|\n')),"\n",l.createElement(n.h3,null,"json data 에 key 와 value 추가 해서 조회하기"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"select id, name, JSON_INSERT(connect, '$.type', \"STORE\") from employees where id = 1;\n")),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,'|id|name|connect|\r\n|---|---|---|\r\n|1|강동|\'{"code":"200122","type":"STORE"}\'|\n')),"\n",l.createElement(n.h3,null,"json data 에 key 와 value 추가해서 table update"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"UPDATE test\r\nset `connect` =\r\nJSON_INSERT(connect, '$.type', 'STORE')\r\nwhere id = 1;\n")),"\n",l.createElement(n.h3,null,"작업을하다가 ... 기능 개발로 기존 data 를 바꿔야 하는 상황..."),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,'|id|name|connect|\r\n|---|---|---|\r\n|1|강동|\'{"code":"100008"}\'|\r\n|2|군포|\'{"code":"200122"}\'|\r\n|3|대전|\'{"code":"200026"}\'|\n')),"\n",l.createElement(n.p,null,'code 가 1로 시작하면 type "CENTER" 로 update\r\ncode 가 2로 시작하면 type "STORE" 로 update'),"\n",l.createElement(n.p,null,"이렇게 Where 절에서 JSON_EXTRACT 에 ",l.createElement(n.code,null,">=")," 와 ",l.createElement(n.code,null,"<")," 로 100000 이상 200000 미만인 경우 CENTER 로 type 을 추가"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"UPDATE test\r\n set `connect` = JSON_replace(connect, '$.type', 'CENTER')\r\nWHERE JSON_EXTRACT(connect, '$.code') >= '100000' AND  JSON_EXTRACT(connect, '$.code') <'200000';\n")),"\n",l.createElement(n.p,null,"이렇게  경우에 따라 update 를 추가하면 귀찮으니 한번에 업데이트 하려면?\r\n",l.createElement(n.code,null,"case when "),"을 사용해 보자"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"UPDATE test\r\n SET `connect` =\r\n CASE\r\n WHEN JSON_EXTRACT(connect, '$.code') <'200000'\r\n\tTHEN  JSON_insert(connect, '$.type', 'CENTER')\r\n WHEN JSON_EXTRACT(connect, '$.code') >= '200000'\r\n\tTHEN  JSON_insert(connect, '$.type', 'STORE')\r\nEND;\n")),"\n",l.createElement(n.p,null,"이렇게 하면 조건에 따라 update 된다."),"\n",l.createElement(n.h3,null,l.createElement(n.a,{href:"https://database.guide/json_set-vs-json_insert-vs-json_replace-in-mysql-whats-the-difference/"},"JSON_SET() vs JSON_INSERT() vs JSON_REPLACE() in MySQL: What’s the Difference?")),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"JSON_SET() replaces existing values and adds nonexisting values."),"\n"),"\n"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"JSON_INSERT() inserts values without replacing existing values."),"\n",l.createElement(n.li,null,"JSON_REPLACE() replaces only existing values."),"\n"),"\n",l.createElement(n.p,null,"JSON_SET 는 데이터가 존재하지 않는 컬럼에도 값을 추가한다"),"\n",l.createElement(n.h3,null,"참고"),"\n",l.createElement(n.p,null,l.createElement(n.a,{href:"https://stackoverflow.com/questions/36264369/mysql-5-7-appending-key-value-to-nested-json-object"},"https://stackoverflow.com/questions/36264369/mysql-5-7-appending-key-value-to-nested-json-object")))}var a=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?l.createElement(n,e,l.createElement(r,e)):r(e)},o=t(8804);function E(e){return l.createElement(o.Z,e,l.createElement(a,e))}o.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-c-github-gwiyeomgo-github-io-content-posts-server-database-mysql-2023-01-03-mysql-json-data-replace-and-insert-mdx-5b91c638410e0adada9d.js.map